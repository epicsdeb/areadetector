From: Michael Davidsaver <mdavidsaver@bnl.gov>
Date: Thu, 3 Nov 2011 09:54:27 -0400
Subject: [PATCH] build aravis and dcam

---
 Makefile                          |   10 ++++++++++
 aravis/aravisGigEApp/Db/Makefile  |    2 +-
 aravis/aravisGigEApp/Makefile     |    4 +---
 aravis/aravisGigEApp/src/Makefile |    6 +++++-
 dcam/firewireDCAMApp/Db/Makefile  |    2 +-
 dcam/firewireDCAMApp/Makefile     |    8 +++-----
 dcam/firewireDCAMApp/src/Makefile |   15 ++++++++++-----
 7 files changed, 31 insertions(+), 16 deletions(-)

diff --git a/Makefile b/Makefile
index 015d84e..58f0999 100644
--- a/Makefile
+++ b/Makefile
@@ -4,5 +4,15 @@ include $(TOP)/configure/CONFIG
 DIRS := $(DIRS) $(filter-out $(DIRS), configure)
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *App))
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *app))
+DIRS := $(DIRS) dcam/firewireDCAMApp aravis/aravisGigEApp
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard iocBoot))
+
+define DIR_template
+ $(1)_DEPEND_DIRS = configure
+endef
+$(foreach dir, $(filter-out configure,$(DIRS)),$(eval $(call DIR_template,$(dir))))
+
+dcam/firewireDCAMApp_DEPEND_DIRS += ADApp
+aravis/aravisGigEApp_DEPEND_DIRS += ADApp
+
 include $(TOP)/configure/RULES_TOP
diff --git a/aravis/aravisGigEApp/Db/Makefile b/aravis/aravisGigEApp/Db/Makefile
index c1903c3..43c7494 100644
--- a/aravis/aravisGigEApp/Db/Makefile
+++ b/aravis/aravisGigEApp/Db/Makefile
@@ -1,4 +1,4 @@
-TOP=../..
+TOP=../../..
 include $(TOP)/configure/CONFIG
 #----------------------------------------
 #  ADD MACRO DEFINITIONS AFTER THIS LINE
diff --git a/aravis/aravisGigEApp/Makefile b/aravis/aravisGigEApp/Makefile
index 7b06cab..2cd8b1f 100644
--- a/aravis/aravisGigEApp/Makefile
+++ b/aravis/aravisGigEApp/Makefile
@@ -1,10 +1,8 @@
-TOP = ..
+TOP = ../..
 include $(TOP)/configure/CONFIG
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *src*))
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *Src*))
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *db*))
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *Db*))
-DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *opi*))
-DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard protocol))
 include $(TOP)/configure/RULES_DIRS
 
diff --git a/aravis/aravisGigEApp/src/Makefile b/aravis/aravisGigEApp/src/Makefile
index 1df3d6b..45e5f30 100644
--- a/aravis/aravisGigEApp/src/Makefile
+++ b/aravis/aravisGigEApp/src/Makefile
@@ -1,4 +1,4 @@
-TOP=../..
+TOP=../../..
 
 include $(TOP)/configure/CONFIG
 
@@ -20,6 +20,7 @@ DBD += aravisCameraSupport.dbd
 
 # If glib is not in a standard place, tell the build system where to look
 ifneq ($(GLIBPREFIX),)
+	USR_INCLUDES += -I$(GLIBPREFIX)/include/aravis-0.2
 	USR_INCLUDES += -I$(GLIBPREFIX)/lib/glib-2.0/include
 	USR_INCLUDES += -I$(GLIBPREFIX)/include/glib-2.0
 	glib-2.0_DIR = $(GLIBPREFIX)/lib
@@ -30,4 +31,7 @@ USR_INCLUDES += -I$(TOP)/include/aravis-0.2
 USR_LIBS += glib-2.0
 USR_LIBS += aravis-0.2
 
+glib-2.0_DIR=/usr/lib
+aravis-0.2_DIR=/usr/lib
+
 include $(TOP)/configure/RULES
diff --git a/dcam/firewireDCAMApp/Db/Makefile b/dcam/firewireDCAMApp/Db/Makefile
index eb9bfa3..59701e8 100644
--- a/dcam/firewireDCAMApp/Db/Makefile
+++ b/dcam/firewireDCAMApp/Db/Makefile
@@ -1,4 +1,4 @@
-TOP=../..
+TOP=../../..
 include $(TOP)/configure/CONFIG
 #----------------------------------------
 #  ADD MACRO DEFINITIONS AFTER THIS LINE
diff --git a/dcam/firewireDCAMApp/Makefile b/dcam/firewireDCAMApp/Makefile
index 7b06cab..9b2a005 100644
--- a/dcam/firewireDCAMApp/Makefile
+++ b/dcam/firewireDCAMApp/Makefile
@@ -1,10 +1,8 @@
-TOP = ..
+TOP = ../..
 include $(TOP)/configure/CONFIG
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *src*))
 DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *Src*))
-DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *db*))
-DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *Db*))
-DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *opi*))
-DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard protocol))
+#DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *db*))
+#DIRS := $(DIRS) $(filter-out $(DIRS), $(wildcard *Db*))
 include $(TOP)/configure/RULES_DIRS
 
diff --git a/dcam/firewireDCAMApp/src/Makefile b/dcam/firewireDCAMApp/src/Makefile
index 3f5e5e2..f4ab336 100644
--- a/dcam/firewireDCAMApp/src/Makefile
+++ b/dcam/firewireDCAMApp/src/Makefile
@@ -1,4 +1,4 @@
-TOP=../..
+TOP=../../..
 
 include $(TOP)/configure/CONFIG
 
@@ -7,10 +7,10 @@ include $(TOP)/configure/CONFIG
 #--------------------------------------------------------
 PROD_IOC += firewiretool
 firewiretool_SRCS_DEFAULT += firewiretool.cpp
-firewiretool_LIBS += dc1394
+firewiretool_LIBS += dc1394 raw1394 usb-1.0
 firewiretool_LIBS += $(EPICS_BASE_IOC_LIBS)
 
-PROD_IOC += testCams
+#PROD_IOC += testCams
 testCams_SRCS_DEFAULT += testCams.cpp
 testCams_LIBS += dc1394
 testCams_LIBS += $(EPICS_BASE_IOC_LIBS)
@@ -41,10 +41,15 @@ firewireDCAM_SRCS += firewireDCAM.cpp
 
 # linking against various basic support libraries
 firewireDCAM_LIBS += asyn
-firewireDCAM_LIBS += ADBase netCDF
-firewireDCAM_LIBS += dc1394 raw1394
+firewireDCAM_LIBS += ADBase netcdf
+firewireDCAM_LIBS += dc1394 raw1394 usb-1.0
 firewireDCAM_LIBS += $(EPICS_BASE_IOC_LIBS)
 
+netcdf_DIR=/usr/lib
+dc1394_DIR=/usr/lib
+raw1394_DIR=/usr/lib
+usb-1.0_DIR=/usr/lib
+
 #include $(AREA_DETECTOR)/ADApp/commonDriverMakefile
 
 include $(TOP)/configure/RULES
-- 
